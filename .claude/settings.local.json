{
  "permissions": {
    "allow": [
      "Bash(python:*)",
      "Bash(C:UsersUSERanaconda3python.exe parse_cura_printers.py)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\":*)",
      "Read(//c/Users/USER/FACTOR HIBRID/FACTOR-HIBRID-r1.0/packages/web/**)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" test_cura.py)",
      "Bash(del /Q test_cura.py test_upload_stl.py test_auto_convert.py)",
      "Bash(git add:*)",
      "Read(//c/Program Files/UltiMaker Cura 5.7.1/share/cura/resources/definitions/**)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" test_all_printers.py)",
      "Bash(pkill:*)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" test_cura_direct.py)",
      "Bash(for f in c:/Users/USER/factor_AI_python/output/*.gcode)",
      "Bash(tail:*)",
      "Bash(done)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c:*)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" test_live_stream.py)",
      "Bash(dir /b \"c:\\Users\\USER\\factor_AI_python\\*.py\")",
      "Bash(dir \"c:\\Users\\USER\\factor_AI_python\" /b)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(ls:*)",
      "Bash(file:*)",
      "Bash(cat:*)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\n# Read the file\nwith open(''c:/Users/USER/factor_AI_python/gcode_analyzer/api/router.py'', ''r'', encoding=''utf-8'') as f:\n    content = f.read()\n\n# Find where to insert new endpoints (after the analyze endpoint)\ninsert_after = ''''''    return {\n        \"\"analysis_id\"\": analysis_id,\n        \"\"status\"\": \"\"pending\"\",\n        \"\"message\"\": \"\"G-code 분석이 시작되었습니다.\"\",\n        \"\"stream_url\"\": f\"\"/api/v1/gcode/analysis/{analysis_id}/stream\"\"\n    }\n\n@router.get(\"\"/analysis/{analysis_id}\"\")''''''\n\nnew_endpoints = ''''''    return {\n        \"\"analysis_id\"\": analysis_id,\n        \"\"status\"\": \"\"pending\"\",\n        \"\"message\"\": \"\"G-code 분석이 시작되었습니다.\"\",\n        \"\"stream_url\"\": f\"\"/api/v1/gcode/analysis/{analysis_id}/stream\"\"\n    }\n\n\n@router.post(\"\"/summary\"\")\nasync def analyze_gcode_summary_only(request: GCodeSummaryRequest, background_tasks: BackgroundTasks):\n    \"\"\"\"\"\"\n    G-code 요약만 분석 (LLM 분석 없음 - 빠름)\n    \n    온도, 피드, 서포트 비율, 예상 출력 시간 등의 요약 정보만 추출합니다.\n    에러 분석은 수행하지 않습니다.\n    \n    - gcode_content: G-code 문자열\n    - printer_info: 프린터 정보 (선택)\n    - filament_type: 필라멘트 타입 (선택)\n    \n    Returns: analysis_id (요약 결과 조회에 사용)\n    \"\"\"\"\"\"\n    analysis_id = request.analysis_id or str(uuid.uuid4())\n    \n    # 임시 파일 생성\n    output_dir = os.getenv(\"\"OUTPUT_DIR\"\", \"\"./output\"\")\n    os.makedirs(output_dir, exist_ok=True)\n    \n    temp_file_path = os.path.join(output_dir, f\"\"gcode_summary_{analysis_id}.gcode\"\")\n    with open(temp_file_path, ''w'', encoding=''utf-8'') as f:\n        f.write(request.gcode_content)\n    \n    # 분석 상태 초기화\n    gcode_analysis_store[analysis_id] = {\n        \"\"status\"\": \"\"pending\"\",\n        \"\"progress\"\": 0.0,\n        \"\"current_step\"\": \"\"initializing\"\",\n        \"\"analysis_mode\"\": \"\"summary_only\"\",\n        \"\"timeline\"\": [],\n        \"\"temp_file\"\": temp_file_path,\n        \"\"printer_info\"\": request.printer_info.dict() if request.printer_info else None,\n        \"\"filament_type\"\": request.filament_type,\n        \"\"user_id\"\": request.user_id,\n        \"\"result\"\": None,\n        \"\"comprehensive_summary\"\": None,\n        \"\"error\"\": None,\n        \"\"created_at\"\": datetime.now().isoformat()\n    }\n    \n    logger.info(f\"\"[GCode] Summary analysis started: {analysis_id}\"\")\n    \n    # 백그라운드에서 요약 분석 실행\n    background_tasks.add_task(run_gcode_summary_task, analysis_id)\n    \n    return {\n        \"\"analysis_id\"\": analysis_id,\n        \"\"status\"\": \"\"pending\"\",\n        \"\"analysis_mode\"\": \"\"summary_only\"\",\n        \"\"message\"\": \"\"G-code 요약 분석이 시작되었습니다. (LLM 분석 없음)\"\",\n        \"\"summary_url\"\": f\"\"/api/v1/gcode/analysis/{analysis_id}/summary\"\"\n    }\n\n\n@router.get(\"\"/analysis/{analysis_id}/summary\"\")\nasync def get_gcode_summary(analysis_id: str):\n    \"\"\"\"\"\"\n    종합 요약 결과만 조회\n    \n    온도, 피드, 서포트 비율, 예상 출력 시간 등의 요약 정보 반환\n    \"\"\"\"\"\"\n    if analysis_id not in gcode_analysis_store:\n        raise HTTPException(status_code=404, detail=\"\"분석을 찾을 수 없습니다.\"\")\n    \n    data = gcode_analysis_store[analysis_id]\n    \n    if data[\"\"status\"\"] not in [\"\"completed\"\", \"\"summary_completed\"\"]:\n        return {\n            \"\"analysis_id\"\": analysis_id,\n            \"\"status\"\": data[\"\"status\"\"],\n            \"\"progress\"\": data[\"\"progress\"\"],\n            \"\"message\"\": \"\"분석이 아직 완료되지 않았습니다.\"\"\n        }\n    \n    comprehensive_summary = data.get(\"\"comprehensive_summary\"\") or data.get(\"\"result\"\", {}).get(\"\"comprehensive_summary\"\")\n    \n    return {\n        \"\"analysis_id\"\": analysis_id,\n        \"\"status\"\": data[\"\"status\"\"],\n        \"\"analysis_mode\"\": data.get(\"\"analysis_mode\"\", \"\"full\"\"),\n        \"\"comprehensive_summary\"\": comprehensive_summary,\n        \"\"timeline\"\": data.get(\"\"timeline\"\", [])\n    }\n\n\n@router.post(\"\"/analysis/{analysis_id}/error-analysis\"\")\nasync def run_error_analysis(analysis_id: str, background_tasks: BackgroundTasks):\n    \"\"\"\"\"\"\n    기존 요약 기반으로 에러 분석 실행\n    \n    이미 요약 분석이 완료된 경우, 추가로 에러 분석을 실행합니다.\n    LLM을 사용하여 문제를 분석하고 패치를 제안합니다.\n    \"\"\"\"\"\"\n    if analysis_id not in gcode_analysis_store:\n        raise HTTPException(status_code=404, detail=\"\"분석을 찾을 수 없습니다.\"\")\n    \n    data = gcode_analysis_store[analysis_id]\n    \n    if data[\"\"status\"\"] not in [\"\"completed\"\", \"\"summary_completed\"\"]:\n        raise HTTPException(status_code=400, detail=\"\"요약 분석이 완료되지 않았습니다. 먼저 요약 분석을 실행하세요.\"\")\n    \n    if data.get(\"\"analysis_mode\"\") == \"\"full\"\" and data[\"\"status\"\"] == \"\"completed\"\":\n        return {\n            \"\"analysis_id\"\": analysis_id,\n            \"\"status\"\": \"\"already_analyzed\"\",\n            \"\"message\"\": \"\"이미 전체 분석이 완료되었습니다.\"\",\n            \"\"result\"\": data.get(\"\"result\"\")\n        }\n    \n    # 에러 분석 모드로 전환\n    data[\"\"status\"\"] = \"\"running_error_analysis\"\"\n    data[\"\"analysis_mode\"\"] = \"\"error_analysis\"\"\n    \n    logger.info(f\"\"[GCode] Error analysis started: {analysis_id}\"\")\n    \n    # 백그라운드에서 에러 분석 실행\n    background_tasks.add_task(run_gcode_error_analysis_task, analysis_id)\n    \n    return {\n        \"\"analysis_id\"\": analysis_id,\n        \"\"status\"\": \"\"running_error_analysis\"\",\n        \"\"message\"\": \"\"에러 분석이 시작되었습니다. (LLM 사용)\"\",\n        \"\"stream_url\"\": f\"\"/api/v1/gcode/analysis/{analysis_id}/stream\"\"\n    }\n\n\n@router.get(\"\"/analysis/{analysis_id}\"\")''''''\n\ncontent = content.replace(insert_after, new_endpoints)\n\n# Write back\nwith open(''c:/Users/USER/factor_AI_python/gcode_analyzer/api/router.py'', ''w'', encoding=''utf-8'') as f:\n    f.write(content)\n\nprint(''Added new endpoints'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\n# Read the file\nwith open(''c:/Users/USER/factor_AI_python/gcode_analyzer/api/router.py'', ''r'', encoding=''utf-8'') as f:\n    content = f.read()\n\n# Append new background tasks at the end\nnew_tasks = ''''''\n\nasync def run_gcode_summary_task(analysis_id: str):\n    \"\"\"\"\"\"백그라운드에서 G-code 요약만 실행 (LLM 없음)\"\"\"\"\"\"\n    from gcode_analyzer.analyzer import run_analysis\n\n    data = gcode_analysis_store[analysis_id]\n    data[\"\"status\"\"] = \"\"running\"\"\n\n    try:\n        logger.info(f\"\"[GCode] Running summary analysis: {analysis_id}\"\")\n\n        # 요약만 분석 실행\n        result = await run_analysis(\n            file_path=data[\"\"temp_file\"\"],\n            filament_type=data.get(\"\"filament_type\"\"),\n            printer_info=data.get(\"\"printer_info\"\"),\n            auto_approve=False,\n            analysis_mode=\"\"summary_only\"\"  # 요약만 모드\n        )\n\n        # 결과 저장\n        data[\"\"status\"\"] = \"\"summary_completed\"\"\n        data[\"\"progress\"\"] = 1.0\n        data[\"\"current_step\"\"] = \"\"summary_completed\"\"\n        data[\"\"comprehensive_summary\"\"] = result.get(\"\"comprehensive_summary\"\")\n        data[\"\"result\"\"] = {\n            \"\"comprehensive_summary\"\": result.get(\"\"comprehensive_summary\"\"),\n            \"\"summary\"\": result.get(\"\"summary\"\"),\n            \"\"timeline\"\": result.get(\"\"timeline\"\", [])\n        }\n        data[\"\"timeline\"\"] = result.get(\"\"timeline\"\", [])\n\n        logger.info(f\"\"[GCode] Summary analysis completed: {analysis_id}\"\")\n\n    except Exception as e:\n        data[\"\"status\"\"] = \"\"error\"\"\n        data[\"\"error\"\"] = str(e)\n        logger.error(f\"\"[GCode] Summary analysis failed: {analysis_id} - {e}\"\")\n        import traceback\n        data[\"\"error_trace\"\"] = traceback.format_exc()\n\n\nasync def run_gcode_error_analysis_task(analysis_id: str):\n    \"\"\"\"\"\"백그라운드에서 에러 분석 실행 (기존 요약 기반)\"\"\"\"\"\"\n    from gcode_analyzer.analyzer import run_error_analysis_only\n\n    data = gcode_analysis_store[analysis_id]\n\n    try:\n        logger.info(f\"\"[GCode] Running error analysis: {analysis_id}\"\")\n\n        # 에러 분석 실행 (기존 파싱 결과 활용)\n        result = await run_error_analysis_only(\n            file_path=data[\"\"temp_file\"\"],\n            filament_type=data.get(\"\"filament_type\"\"),\n            printer_info=data.get(\"\"printer_info\"\"),\n            existing_summary=data.get(\"\"comprehensive_summary\"\")\n        )\n\n        # 결과 저장\n        data[\"\"status\"\"] = \"\"completed\"\"\n        data[\"\"progress\"\"] = 1.0\n        data[\"\"current_step\"\"] = \"\"completed\"\"\n        data[\"\"result\"\"] = {\n            \"\"comprehensive_summary\"\": data.get(\"\"comprehensive_summary\"\"),\n            \"\"final_summary\"\": result.get(\"\"final_summary\"\", {}),\n            \"\"issues_found\"\": result.get(\"\"issues_found\"\", []),\n            \"\"patch_plan\"\": result.get(\"\"patch_plan\"\"),\n            \"\"timeline\"\": result.get(\"\"timeline\"\", []),\n            \"\"token_usage\"\": result.get(\"\"token_usage\"\", {})\n        }\n        # 타임라인 병합\n        existing_timeline = data.get(\"\"timeline\"\", [])\n        new_timeline = result.get(\"\"timeline\"\", [])\n        data[\"\"timeline\"\"] = existing_timeline + new_timeline\n\n        logger.info(f\"\"[GCode] Error analysis completed: {analysis_id}\"\")\n\n    except Exception as e:\n        data[\"\"status\"\"] = \"\"error\"\"\n        data[\"\"error\"\"] = str(e)\n        logger.error(f\"\"[GCode] Error analysis failed: {analysis_id} - {e}\"\")\n        import traceback\n        data[\"\"error_trace\"\"] = traceback.format_exc()\n''''''\n\ncontent = content.rstrip() + new_tasks\n\n# Write back\nwith open(''c:/Users/USER/factor_AI_python/gcode_analyzer/api/router.py'', ''w'', encoding=''utf-8'') as f:\n    f.write(content)\n\nprint(''Added background tasks'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\n# 문법 체크\ntry:\n    from gcode_analyzer.gcode_summary_analyzer import GCodeSummaryAnalyzer, analyze_gcode_summary\n    print(''gcode_summary_analyzer: OK'')\nexcept Exception as e:\n    print(f''gcode_summary_analyzer: ERROR - {e}'')\n\ntry:\n    from gcode_analyzer.workflow.state import AnalysisState\n    print(''workflow.state: OK'')\nexcept Exception as e:\n    print(f''workflow.state: ERROR - {e}'')\n\ntry:\n    from gcode_analyzer.workflow.nodes import parse_node, comprehensive_summary_node, analyze_events_node\n    print(''workflow.nodes: OK'')\nexcept Exception as e:\n    print(f''workflow.nodes: ERROR - {e}'')\n\ntry:\n    from gcode_analyzer.workflow.graph import compile_workflow\n    print(''workflow.graph: OK'')\nexcept Exception as e:\n    print(f''workflow.graph: ERROR - {e}'')\n\ntry:\n    from gcode_analyzer.analyzer import run_analysis, run_error_analysis_only\n    print(''analyzer: OK'')\nexcept Exception as e:\n    print(f''analyzer: ERROR - {e}'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.gcode_summary_analyzer import analyze_gcode_summary\nfrom gcode_analyzer.parser import parse_gcode\n\n# 샘플 G-code 파일 분석\nfile_path = ''c:/Users/USER/factor_AI_python/tests/fixtures/sample.gcode''\n\nprint(''파싱 중...'')\nparsed_lines = parse_gcode(file_path)\nprint(f''총 {len(parsed_lines)}줄'')\n\nprint(''\\n요약 분석 중...'')\nsummary = analyze_gcode_summary(parsed_lines, file_path)\n\nprint(''\\n=== 종합 요약 결과 ==='')\nprint(f''파일: {summary.file_name}'')\nprint(f''총 라인: {summary.total_lines:,}줄'')\nprint(f''슬라이서: {summary.slicer_info}'')\nprint(f''필라멘트: {summary.filament_type}'')\nprint()\nprint(''--- 온도 ---'')\nprint(f''노즐: {summary.temperature.nozzle_min}°C ~ {summary.temperature.nozzle_max}°C (평균: {summary.temperature.nozzle_avg:.1f}°C)'')\nprint(f''베드: {summary.temperature.bed_min}°C ~ {summary.temperature.bed_max}°C'')\nprint(f''온도 변경: {summary.temperature.nozzle_changes}회'')\nprint()\nprint(''--- 속도 ---'')\nprint(f''속도 범위: {summary.feed_rate.min_speed:.0f} ~ {summary.feed_rate.max_speed:.0f} mm/min'')\nprint(f''평균 속도: {summary.feed_rate.avg_speed:.0f} mm/min'')\nprint()\nprint(''--- 레이어 ---'')\nprint(f''총 레이어: {summary.layer.total_layers}층'')\nprint(f''레이어 높이: {summary.layer.avg_layer_height:.2f}mm'')\nprint()\nprint(''--- 익스트루전 ---'')\nprint(f''총 익스트루전: {summary.extrusion.total_extrusion:.2f}mm'')\nprint(f''필라멘트 사용량: {summary.extrusion.total_filament_used:.2f}m'')\nprint(f''리트랙션: {summary.extrusion.retraction_count}회'')\nprint()\nprint(''--- 서포트 ---'')\nprint(f''서포트 사용: {\"\"예\"\" if summary.support.has_support else \"\"아니오\"\"}'')\nif summary.support.has_support:\n    print(f''서포트 비율: {summary.support.support_ratio:.1f}%'')\nprint()\nprint(''--- 예상 시간 ---'')\nprint(f''총 시간: {summary.print_time.formatted_time}'')\nprint()\nprint(''--- 구간 ---'')\nprint(f''시작 G-code: {summary.start_gcode_lines}줄'')\nprint(f''본문: {summary.body_lines}줄'')\nprint(f''종료 G-code: {summary.end_gcode_lines}줄'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.gcode_summary_analyzer import analyze_gcode_summary\nfrom gcode_analyzer.parser import parse_gcode\n\n# 더 큰 G-code 파일 분석\nfile_path = ''c:/Users/USER/factor_AI_python/output/uploaded_model_1761418759764_1761418759.gcode''\n\nprint(''Parsing...'')\nparsed_lines = parse_gcode(file_path)\nprint(f''Total lines: {len(parsed_lines):,}'')\n\nprint(''\\nAnalyzing summary...'')\nsummary = analyze_gcode_summary(parsed_lines, file_path)\n\nprint(''\\n=== COMPREHENSIVE SUMMARY ==='')\nprint(f''File: {summary.file_name}'')\nprint(f''Total lines: {summary.total_lines:,}'')\nprint(f''Slicer: {summary.slicer_info}'')\nprint(f''Filament: {summary.filament_type}'')\nprint()\nprint(''--- Temperature ---'')\nprint(f''Nozzle: {summary.temperature.nozzle_min}C ~ {summary.temperature.nozzle_max}C (avg: {summary.temperature.nozzle_avg:.1f}C)'')\nprint(f''Bed: {summary.temperature.bed_min}C ~ {summary.temperature.bed_max}C'')\nprint(f''Temp changes: {summary.temperature.nozzle_changes}'')\nprint()\nprint(''--- Speed ---'')\nprint(f''Range: {summary.feed_rate.min_speed:.0f} ~ {summary.feed_rate.max_speed:.0f} mm/min'')\nprint(f''Average: {summary.feed_rate.avg_speed:.0f} mm/min'')\nprint()\nprint(''--- Layer ---'')\nprint(f''Total layers: {summary.layer.total_layers}'')\nprint(f''Layer height: {summary.layer.avg_layer_height:.2f}mm'')\nprint()\nprint(''--- Extrusion ---'')\nprint(f''Total extrusion: {summary.extrusion.total_extrusion:.2f}mm'')\nprint(f''Filament used: {summary.extrusion.total_filament_used:.2f}m'')\nprint(f''Retractions: {summary.extrusion.retraction_count}'')\nprint()\nprint(''--- Support ---'')\nprint(f''Has support: {summary.support.has_support}'')\nif summary.support.has_support:\n    print(f''Support ratio: {summary.support.support_ratio:.1f}%'')\nprint()\nprint(''--- Print time ---'')\nprint(f''Estimated: {summary.print_time.formatted_time}'')\nprint()\nprint(''--- Sections ---'')\nprint(f''Start G-code: {summary.start_gcode_lines} lines'')\nprint(f''Body: {summary.body_lines} lines'')\nprint(f''End G-code: {summary.end_gcode_lines} lines'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\n# 노트북 구조 검증\nimport json\nwith open(''c:/Users/USER/factor_AI_python/tests/gcode_workflow_test.ipynb'', ''r'', encoding=''utf-8'') as f:\n    nb = json.load(f)\n\nprint(f''노트북 셀 수: {len(nb[\"\"cells\"\"])}개'')\nprint(f''커널: {nb[\"\"metadata\"\"][\"\"kernelspec\"\"][\"\"display_name\"\"]}'')\nprint()\n\n# 모듈 임포트 테스트\nprint(''모듈 임포트 테스트...'')\ntry:\n    from gcode_analyzer.workflow.nodes import (\n        parse_node, \n        comprehensive_summary_node,\n        analyze_events_node,\n        llm_analyze_node,\n        final_summary_node,\n        apply_patch_node\n    )\n    print(''  ✅ workflow.nodes'')\nexcept Exception as e:\n    print(f''  ❌ workflow.nodes: {e}'')\n\ntry:\n    from gcode_analyzer.analyzer import run_analysis, _create_initial_state\n    print(''  ✅ analyzer'')\nexcept Exception as e:\n    print(f''  ❌ analyzer: {e}'')\n\ntry:\n    from gcode_analyzer.api.router import _create_dashboard_response, DashboardSummaryResponse\n    print(''  ✅ api.router'')\nexcept Exception as e:\n    print(f''  ❌ api.router: {e}'')\n\nprint()\nprint(''✅ 노트북 준비 완료!'')\n\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"from gcode_analyzer.llm.printing_summary import generate_printing_summary; print(''printing_summary import OK'')\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"from gcode_analyzer.analyzer import run_analysis; print(''analyzer import OK'')\")",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" teststest_rate_limiter.py)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" tests/test_rate_limiter.py)",
      "Bash(\"C:\\Users\\USER\\anaconda3\\python.exe\" -c \"import sys; sys.path.insert(0, ''c:/Users/USER/factor_AI_python''); from gcode_analyzer.rate_limiter import GeminiRateLimiter, RateLimitConfig, RateLimitError; import asyncio; config = RateLimitConfig(user_rpm=5, user_daily_limit=10); limiter = GeminiRateLimiter(config); print(''Rate Limiter created successfully''); print(f''Stats: {limiter.get_stats()}'')\")",
      "Bash(git fetch:*)",
      "Bash(git stash push:*)",
      "Bash(TEST='{\"\"\"\"context_window\"\"\"\":{\"\"\"\"context_window_used\"\"\"\":220000,\"\"\"\"context_window_size\"\"\"\":200000}}' echo \"$TEST\")",
      "Bash(git merge:*)",
      "Bash(where:*)",
      "Bash(C:UsersUSERanaconda3python.exe -c \"print(''hello'')\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\":*)",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"import sys; sys.path.insert(0, ''c:/Users/USER/factor_AI_python''); from gcode_analyzer.segment_extractor import extract_segments; print(''import ok'')\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" \"c:/Users/USER/factor_AI_python/test_segment_extractor.py\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" \"c:/Users/USER/factor_AI_python/test_supabase_gcode.py\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\nfrom supabase_client import get_supabase_client\n\nsupabase = get_supabase_client()\n\n# 스크린샷에서 보이는 user ID로 직접 접근\nuser_ids = [\n    ''3fc7b7e3-5ce2-4035-bfd9-'',\n    ''53f3ac1c-02b4-416b-b9c9-'',\n    ''635a5e0b-7fa4-4ed1-9f85-'',\n    ''9b19b606-54ce-4c62-be7-'',\n    ''a90b65bc-afdb-43c1-9f2b-'',\n    ''b39f68be-b39c-4f19-846e-'',\n    ''be61c171-e84a-4652-949d-'',\n]\n\n# 특정 폴더 직접 시도\nprint(''Testing specific paths...'')\ntest_paths = [\n    ''3fc7b7e3-5ce2-4035-bfd9-'',\n    ''gcode_analysis'',\n]\n\nfor path in test_paths:\n    try:\n        print(f''\\nTrying path: {path}'')\n        contents = supabase.storage.from_(''gcode-files'').list(path)\n        print(f''  Found {len(contents)} items'')\n        for item in contents[:5]:\n            print(f''    - {item}'')\n    except Exception as e:\n        print(f''  Error: {str(e)[:100]}'')\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c:*)",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\n\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\n\n# LAYER_CHANGE 또는 layer num 찾기\nfor i, line in enumerate(lines):\n    raw = line.raw or ''''\n    if ''LAYER_CHANGE'' in raw or ''; layer num/'' in raw.lower():\n        print(f''{i}: {raw[:80]}'')\n        # 그 뒤 50줄 분석\n        print(f''\\n=== Layer 0 근처 이동 명령 ==='')\n        for j in range(i, min(i+80, len(lines))):\n            l = lines[j]\n            if l.cmd in [''G0'', ''G1''] and (''X'' in l.params or ''Y'' in l.params):\n                e_val = l.params.get(''E'', '''')\n                z_val = l.params.get(''Z'', '''')\n                x_val = l.params.get(''X'', '''')\n                y_val = l.params.get(''Y'', '''')\n                has_e = ''E='' + str(e_val) if e_val != '''' else ''''\n                print(f''{j}: {l.cmd} X={x_val} Y={y_val} Z={z_val} {has_e} ; {(l.comment or \"\"\"\")[:30]}'')\n            elif l.comment and (''TYPE'' in l.comment.upper() or ''LAYER'' in l.comment.upper()):\n                print(f''{j}: ; {l.comment[:50]}'')\n        break\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\n\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\n\n# 실제 ; LAYER_CHANGE 찾기 (주석 내 또는 raw에서)\nfor i, line in enumerate(lines):\n    raw = line.raw or ''''\n    comment = line.comment or ''''\n    if ''LAYER_CHANGE'' in raw or ''LAYER_CHANGE'' in comment:\n        print(f''{i}: RAW={raw[:60]}'')\n\n# 아니면 TYPE: 찾기\nprint(''\\n=== TYPE 마커 검색 ==='')\ntype_count = 0\nfor i, line in enumerate(lines):\n    comment = line.comment or ''''\n    if ''TYPE:'' in comment.upper():\n        if type_count < 10:\n            print(f''{i}: {comment[:60]}'')\n        type_count += 1\nprint(f''Total TYPE markers: {type_count}'')\n\n# Z값 변화 시점 찾기\nprint(''\\n=== Z값 변화 (처음 10개) ==='')\nprev_z = 0\nz_changes = 0\nfor i, line in enumerate(lines):\n    if line.cmd in [''G0'', ''G1''] and ''Z'' in line.params:\n        z = line.params[''Z'']\n        if abs(z - prev_z) > 0.05:\n            if z_changes < 10:\n                print(f''{i}: Z={z} (prev={prev_z})'')\n            z_changes += 1\n            prev_z = z\nprint(f''Total Z changes: {z_changes}'')\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\n\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\n\n# layer num/total 패턴 찾기\nfor i, line in enumerate(lines):\n    raw = line.raw or ''''\n    if ''; layer num/'' in raw.lower():\n        print(f''{i}: {raw[:80]}'')\n        if i < 5:\n            continue\n        # 이 레이어 근처 분석\n        print(f''\\n=== Layer 근처 출력 명령 ==='')\n        for j in range(i-5, min(i+100, len(lines))):\n            l = lines[j]\n            if l.cmd in [''G0'', ''G1'', ''G92'']:\n                e_val = l.params.get(''E'', '''')\n                z_val = l.params.get(''Z'', '''')\n                x_val = l.params.get(''X'', '''')\n                y_val = l.params.get(''Y'', '''')\n                print(f''{j}: {l.cmd} X={x_val} Y={y_val} Z={z_val} E={e_val}'')\n            elif l.comment:\n                c = l.comment[:60]\n                if ''TYPE'' in c.upper() or ''layer'' in c.lower() or ''WIPE'' in c.upper():\n                    print(f''{j}: ; {c}'')\n        break\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\n\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\n\n# 실제 출력 시작점: G1 with E > 0 처음 발견\nprint(''=== E값이 있는 첫 G1 명령들 (1000줄 이후) ==='')\nfound = 0\nfor i, line in enumerate(lines):\n    if i < 1000:  # 헤더 건너뛰기\n        continue\n    if line.cmd == ''G1'' and ''E'' in line.params and ''X'' in line.params:\n        e_val = line.params.get(''E'', 0)\n        if e_val > 0:\n            print(f''{i}: {line.raw[:80]}'')\n            found += 1\n            if found >= 20:\n                break\n\n# Outer wall 또는 실제 출력 TYPE 찾기\nprint(''\\n=== Outer wall/Inner wall TYPE 마커 ==='')\nfound = 0\nfor i, line in enumerate(lines):\n    comment = line.comment or ''''\n    if ''Outer wall'' in comment or ''Inner wall'' in comment or ''TYPE:WALL'' in comment.upper():\n        print(f''{i}: {comment[:60]}'')\n        # 이후 10줄\n        for j in range(i+1, min(i+15, len(lines))):\n            l = lines[j]\n            if l.cmd in [''G0'', ''G1'']:\n                e = l.params.get(''E'', '''')\n                x = l.params.get(''X'', '''')\n                y = l.params.get(''Y'', '''')\n                z = l.params.get(''Z'', '''')\n                print(f''  {j}: {l.cmd} X={x} Y={y} Z={z} E={e}'')\n        found += 1\n        if found >= 3:\n            break\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.section_detector import detect_sections\n\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\nboundaries = detect_sections(lines)\n\n# BODY 구간에서 출력 속도 (G1 + E > 0) 분석\nprint_speeds = []\nfor line in lines:\n    if line.index < boundaries.start_end or line.index > boundaries.body_end:\n        continue\n    if line.cmd == ''G1'' and ''F'' in line.params and ''E'' in line.params:\n        e_val = line.params.get(''E'', 0)\n        if e_val > 0:\n            print_speeds.append(line.params[''F''])\n\nprint(''=== Print Speed Distribution (BODY section) ==='')\nprint(f''Total print moves with E>0: {len(print_speeds)}'')\nif print_speeds:\n    print(f''Min: {min(print_speeds):.0f} mm/min = {min(print_speeds)/60:.1f} mm/s'')\n    print(f''Max: {max(print_speeds):.0f} mm/min = {max(print_speeds)/60:.1f} mm/s'')\n    print(f''Avg: {sum(print_speeds)/len(print_speeds):.0f} mm/min = {sum(print_speeds)/len(print_speeds)/60:.1f} mm/s'')\n    \n    # Distribution\n    from collections import Counter\n    speed_buckets = Counter()\n    for s in print_speeds:\n        bucket = int(s / 60 // 50) * 50  # 50 mm/s buckets\n        speed_buckets[bucket] += 1\n    \n    print()\n    print(''Speed distribution (mm/s buckets):'')\n    for bucket in sorted(speed_buckets.keys()):\n        count = speed_buckets[bucket]\n        pct = count / len(print_speeds) * 100\n        bar = ''#'' * int(pct / 2)\n        print(f''  {bucket:3d}-{bucket+50:3d} mm/s: {count:6d} ({pct:5.1f}%) {bar}'')\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.temp_tracker import extract_temp_events\nfrom gcode_analyzer.section_detector import detect_sections, SectionBoundaries\nfrom gcode_analyzer.rule_engine import (\n    rule_excessive_print_speed,\n    rule_too_slow_print_speed,\n    rule_zero_speed_extrusion,\n    rule_rapid_speed_change,\n)\n\n# 테스트 파일\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\ntotal_lines = len(lines)\n\nprint(f''총 라인 수: {total_lines}'')\n\n# 섹션 감지 - 반환 값이 SectionBoundaries 객체임\nboundaries = detect_sections(lines)\nprint(f''BODY: {boundaries.body_start} ~ {boundaries.body_end}'')\nprint(f''boundaries type: {type(boundaries)}'')\n\n# 온도 이벤트\ntemp_events = extract_temp_events(lines)\nprint(f''온도 이벤트 수: {len(temp_events)}'')\n\n# 각 속도 규칙 테스트\nprint(''\\n=== 속도 규칙 테스트 ==='')\n\n# 1. 과도한 속도\nprint(''\\n[1] rule_excessive_print_speed'')\nresults = rule_excessive_print_speed(lines, temp_events, boundaries)\nfor r in results:\n    if r.triggered:\n        print(f''  - {r.anomaly.severity}: {r.anomaly.message}'')\n        print(f''    context: {r.anomaly.context}'')\nif not results or not any(r.triggered for r in results):\n    print(''  (감지 없음)'')\n\n# 2. 너무 느린 속도\nprint(''\\n[2] rule_too_slow_print_speed'')\nresults = rule_too_slow_print_speed(lines, temp_events, boundaries)\nfor r in results:\n    if r.triggered:\n        print(f''  - {r.anomaly.severity}: {r.anomaly.message}'')\nif not results or not any(r.triggered for r in results):\n    print(''  (감지 없음)'')\n\n# 3. 속도 0 익스트루전\nprint(''\\n[3] rule_zero_speed_extrusion'')\nresults = rule_zero_speed_extrusion(lines, temp_events, boundaries)\nfor r in results:\n    if r.triggered:\n        print(f''  - {r.anomaly.severity}: {r.anomaly.message}'')\nif not results or not any(r.triggered for r in results):\n    print(''  (감지 없음)'')\n\n# 4. 급격한 속도 변화\nprint(''\\n[4] rule_rapid_speed_change'')\nresults = rule_rapid_speed_change(lines, temp_events, boundaries)\nfor r in results:\n    if r.triggered:\n        print(f''  - {r.anomaly.severity}: {r.anomaly.message}'')\n        print(f''    context: {r.anomaly.context}'')\nif not results or not any(r.triggered for r in results):\n    print(''  (감지 없음)'')\n\n# 속도 통계 출력\nprint(''\\n=== 속도 분포 분석 ==='')\ncurrent_f = 0.0\nspeed_samples = []\nfor line in lines:\n    if line.cmd in [''G0'', ''G1''] and ''F'' in line.params:\n        current_f = line.params[''F'']\n    if line.cmd == ''G1'' and ''E'' in line.params:\n        e_val = line.params.get(''E'', 0)\n        if e_val > 0 and current_f > 0:\n            speed_samples.append(current_f / 60)  # mm/s로 변환\n\nif speed_samples:\n    print(f''출력 이동 수: {len(speed_samples)}'')\n    print(f''속도 범위: {min(speed_samples):.1f} ~ {max(speed_samples):.1f} mm/s'')\n    print(f''평균 속도: {sum(speed_samples)/len(speed_samples):.1f} mm/s'')\n    \n    # 속도 구간별 분포\n    ranges = [(0, 30), (30, 70), (70, 150), (150, 300), (300, 500), (500, 1000)]\n    print(''\\n속도 구간별 분포:'')\n    for low, high in ranges:\n        count = sum(1 for s in speed_samples if low <= s < high)\n        pct = count / len(speed_samples) * 100\n        print(f''  {low:3d}-{high:3d} mm/s: {count:6d} ({pct:5.1f}%)'')\n\")",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" -c \"\nimport sys\nsys.path.insert(0, ''c:/Users/USER/factor_AI_python'')\n\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.section_detector import detect_sections, SectionBoundaries\n\n# 테스트 파일\nfile_path = r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode''\nresult = parse_gcode(file_path)\nlines = result.lines\n\n# 섹션 감지\nboundaries = detect_sections(lines)\nprint(f''boundaries type: {type(boundaries)}'')\nprint(f''boundaries: {boundaries}'')\nprint(f''dir: {[a for a in dir(boundaries) if not a.startswith(\"\"_\"\")]}'')\n\")",
      "Bash(where python:*)",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"print(''hello'')\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport json\n\nwith open(''test_analysis_result.json'', ''r'', encoding=''utf-8'') as f:\n    result = json.load(f)\n\n# 핵심 내용만 출력\nprint(''=== 분석 결과 요약 ==='')\n\n# 1. Expert Assessment \nexpert = result.get(''final_summary'', {}).get(''expert_assessment'', {})\nif expert:\n    print(f''\\n품질 점수: {expert.get(\"\"quality_score\"\", \"\"?\"\")} ({expert.get(\"\"quality_grade\"\", \"\"?\"\")})'')\n    print(f''요약: {expert.get(\"\"summary_text\"\", \"\"N/A\"\")[:200]}'')\n\n# 2. Critical Issues (이슈 ID 포함)\nissues = result.get(''final_summary'', {}).get(''critical_issues'', [])\nprint(f''\\n=== Critical Issues ({len(issues)}개) ==='')\nfor issue in issues[:10]:\n    print(f''- ID: {issue.get(\"\"id\"\", \"\"N/A\"\")}'')\n    print(f''  Line: {issue.get(\"\"line\"\", \"\"?\"\")}'')\n    print(f''  Type: {issue.get(\"\"type\"\", \"\"?\"\")}'')\n    print(f''  Severity: {issue.get(\"\"severity\"\", \"\"?\"\")}'')\n    print(f''  Title: {issue.get(\"\"title\"\", \"\"?\"\")}'')\n    print(f''  Patch ID: {issue.get(\"\"patch_id\"\", \"\"없음\"\")}'')\n    print()\n\n# 3. Patch Plan (패치 ID 포함)\npatch_plan = result.get(''patch_plan'', {})\npatches = patch_plan.get(''patches'', [])\nprint(f''=== Patch Plan ({len(patches)}개) ==='')\nfor patch in patches[:10]:\n    print(f''- Patch ID: {patch.get(\"\"patch_id\"\", \"\"N/A\"\")}'')\n    print(f''  Line: {patch.get(\"\"line_index\"\", \"\"?\"\")}'')\n    print(f''  Action: {patch.get(\"\"action\"\", \"\"?\"\")}'')\n    print(f''  Original: {patch.get(\"\"original_line\"\", \"\"?\"\")[:60]}'')\n    print(f''  New: {patch.get(\"\"new_line\"\", \"\"없음\"\")}'')\n    print(f''  Issue ID: {patch.get(\"\"issue_id\"\", \"\"없음\"\")}'')\n    print()\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c:*)",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport json\n\nwith open(''snowman_analysis_result.json'', ''r'', encoding=''utf-8'') as f:\n    result = json.load(f)\n\n# llm_results 확인\nprint(''=== LLM Results ==='')\nllm_results = result.get(''llm_results'', [])\nprint(f''  Total: {len(llm_results)}'')\nfor r in llm_results[:5]:\n    print(f''  {r}'')\n    print()\n\n# issues_found 상세\nprint(''=== Issues Found (상세) ==='')\nissues_found = result.get(''issues_found'', [])\nfor issue in issues_found:\n    print(json.dumps(issue, indent=2, ensure_ascii=False, default=str))\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nfrom gcode_analyzer.analyzer import run_analysis_sync\nimport json\n\nresult = run_analysis_sync(\n    file_path=r''C:\\Users\\USER\\Desktop\\snowman_ai.gcode'',\n    filament_type=''PLA'',\n    auto_approve=False\n)\n\nwith open(''snowman_analysis_result_v2.json'', ''w'', encoding=''utf-8'') as f:\n    json.dump(result, f, indent=2, ensure_ascii=False, default=str)\n\nprint(''분석 완료!'')\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport asyncio\nimport json\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.llm.patch_generator import generate_patch_for_issue, extract_snippet\n\n# 파싱\nprint(''G-code 파싱 중...'')\nresult = parse_gcode(r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode'')\nlines = result.lines\nprint(f''총 라인: {len(lines):,}'')\n\n# 분석 결과 로드\nwith open(''cup2_analysis_result.json'', ''r'', encoding=''utf-8'') as f:\n    analysis = json.load(f)\n\n# 이슈 확인\nissues = analysis.get(''final_summary'', {}).get(''issues'', [])\nprint(f''이슈: {len(issues)}개'')\n\n# 첫 번째 이슈로 패치 생성 테스트\nif issues:\n    first_issue = issues[0]\n    line_num = first_issue.get(''line'')\n    \n    print(f''\\n=== 테스트 이슈 ==='')\n    print(f''ID: {first_issue.get(\"\"id\"\")}'')\n    print(f''Line: {line_num}'')\n    print(f''Type: {first_issue.get(\"\"type\"\")}'')\n    print(f''Title: {first_issue.get(\"\"title\"\")}'')\n    \n    # 스니펫 추출\n    snippet = extract_snippet(lines, line_num, context_size=5)\n    print(f''\\n=== 원본 스니펫 ==='')\n    for l in snippet[''before'']:\n        print(f''  {l}'')\n    print(f''>>> {line_num}: {snippet[\"\"target\"\"]} <<<'')\n    for l in snippet[''after'']:\n        print(f''  {l}'')\n\n    # 필라멘트 정보 (PLA 기준)\n    filament_info = {\n        ''type'': ''PLA'',\n        ''nozzle_temp'': ''200-220'',  # 권장 온도 범위\n        ''bed_temp'': ''60''\n    }\n    \n    print(''\\nLLM 패치 생성 중...'')\n    \n    async def test_patch():\n        patch_result, tokens = await generate_patch_for_issue(\n            issue=first_issue,\n            lines=lines,\n            filament_info=filament_info,\n            slicer_info=''Bambu Studio'',\n            language=''ko''\n        )\n        return patch_result, tokens\n    \n    patch_result, tokens = asyncio.run(test_patch())\n    \n    print(f''\\n=== 패치 생성 결과 ==='')\n    print(json.dumps(patch_result, indent=2, ensure_ascii=False))\n    print(f''\\n토큰: {tokens}'')\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport asyncio\nimport json\nfrom gcode_analyzer.analyzer import run_analysis\n\nasync def test():\n    result = await run_analysis(\n        file_path=r''C:\\Users\\USER\\Downloads\\1765728704381_cup2_14_2_A1.gcode'',\n        filament_type=''PLA'',\n        auto_approve=False,\n        language=''ko''\n    )\n    \n    # 결과 저장\n    with open(''test_patch_result.json'', ''w'', encoding=''utf-8'') as f:\n        json.dump(result, f, indent=2, ensure_ascii=False, default=str)\n    \n    print(''=== 분석 완료 ==='')\n    \n    # patch_plan 확인\n    patch_plan = result.get(''patch_plan'')\n    if patch_plan:\n        print(f''\\n총 패치 수: {patch_plan.get(\"\"total_patches\"\", 0)}'')\n        patches = patch_plan.get(''patches'', [])\n        print(f''패치 배열 길이: {len(patches)}'')\n        \n        if patches:\n            print(''\\n=== 첫 번째 패치 데이터 ==='')\n            first_patch = patches[0]\n            for key, value in first_patch.items():\n                print(f''  {key}: {value}'')\n    else:\n        print(''패치 계획 없음'')\n    \n    # issues 확인\n    final_summary = result.get(''final_summary'', {})\n    issues = final_summary.get(''issues'', [])\n    print(f''\\n=== 이슈 수: {len(issues)} ==='')\n    if issues:\n        first_issue = issues[0]\n        print(''첫 번째 이슈:'')\n        for key, value in first_issue.items():\n            print(f''  {key}: {value}'')\n\nasyncio.run(test())\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport json\n\nwith open(''test_patch_result.json'', ''r'', encoding=''utf-8'') as f:\n    result = json.load(f)\n\npatch_plan = result.get(''patch_plan'', {})\npatches = patch_plan.get(''patches'', [])\n\nprint(''=== 전체 패치 데이터 ==='')\nprint(f''총 패치 수: {len(patches)}'')\nprint()\n\nfor i, p in enumerate(patches):\n    print(f''--- 패치 {i+1} ---'')\n    print(f''  id: {p.get(\"\"id\"\")}'')\n    print(f''  issue_id: {p.get(\"\"issue_id\"\")}'')\n    print(f''  line: {p.get(\"\"line\"\")}'')\n    print(f''  layer: {p.get(\"\"layer\"\")}'')\n    print(f''  action: {p.get(\"\"action\"\")}'')\n    print(f''  modified: {p.get(\"\"modified\"\")}'')\n    print(f''  position: {p.get(\"\"position\"\")}'')\n    print(f''  original: {p.get(\"\"original\"\")[:50] if p.get(\"\"original\"\") else None}...'')\n    print(f''  issue_type: {p.get(\"\"issue_type\"\")}'')\n    print(f''  autofix_allowed: {p.get(\"\"autofix_allowed\"\")}'')\n    print(f''  vendor_extension: {p.get(\"\"vendor_extension\"\")}'')\n    print()\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nfrom gcode_analyzer.parser import parse_gcode\n\n# 파싱 결과 구조 확인\nresult = parse_gcode(''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'')\nprint(type(result))\nprint(dir(result))\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.temp_tracker import extract_temp_events\nfrom gcode_analyzer.section_detector import detect_sections\nfrom gcode_analyzer.rule_engine import run_all_rules, get_rule_summary\n\n# 파싱\nresult = parse_gcode(''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'')\nlines = result.lines\ntemp_events = extract_temp_events(lines)\nprint(f''총 라인: {len(lines)}'')\nprint(f''온도 이벤트: {len(temp_events)}'')\n\n# 온도 이벤트 확인\nfor e in temp_events:\n    print(f''  Line {e.line_index}: {e.cmd} S{e.temp}'')\n\n# 섹션 감지\nboundaries = detect_sections(lines, temp_events)\nprint(f''\\nSTART: 1 ~ {boundaries.body_start-1}'')\nprint(f''BODY: {boundaries.body_start} ~ {boundaries.body_end}'')\nprint(f''END: {boundaries.body_end+1} ~'')\n\n# 규칙 실행\nresults = run_all_rules(lines, temp_events, boundaries)\nsummary = get_rule_summary(results)\nprint(f''\\n=== 규칙 실행 결과 ==='')\nprint(f''총 규칙: {summary[\"\"total_rules_run\"\"]}개'')\nprint(f''트리거됨: {summary[\"\"total_triggered\"\"]}개'')\nprint(f''규칙별: {summary[\"\"by_rule\"\"]}'')\n\n# 이슈 상세\ntriggered = [r for r in results if r.triggered]\nfor r in triggered:\n    print(f''\\n--- {r.rule_name} ---'')\n    if r.anomaly:\n        print(f''  라인: {r.anomaly.line_index}'')\n        print(f''  심각도: {r.anomaly.severity}'')\n        print(f''  메시지: {r.anomaly.message}'')\n        if r.anomaly.context and ''fix'' in r.anomaly.context:\n            print(f''  해결: {r.anomaly.context[\"\"fix\"\"]}'')\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.temp_tracker import extract_temp_events\nfrom gcode_analyzer.section_detector import detect_sections\nfrom gcode_analyzer.rule_engine import run_all_rules, get_rule_summary\n\n# 파싱\nresult = parse_gcode(''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'')\nlines = result.lines\ntemp_events = extract_temp_events(lines)\nprint(f''총 라인: {len(lines)}'')\nprint(f''온도 이벤트: {len(temp_events)}'')\n\n# 섹션 감지 (라인만 전달)\nboundaries = detect_sections(lines)\nprint(f''\\nSTART: 1 ~ {boundaries.body_start-1}'')\nprint(f''BODY: {boundaries.body_start} ~ {boundaries.body_end}'')\nprint(f''END: {boundaries.body_end+1} ~'')\n\n# 규칙 실행\nresults = run_all_rules(lines, temp_events, boundaries)\nsummary = get_rule_summary(results)\nprint(f''\\n=== 규칙 실행 결과 ==='')\nprint(f''총 규칙: {summary[\"\"total_rules_run\"\"]}개'')\nprint(f''트리거됨: {summary[\"\"total_triggered\"\"]}개'')\nprint(f''규칙별: {summary[\"\"by_rule\"\"]}'')\n\n# 이슈 상세\ntriggered = [r for r in results if r.triggered]\nfor r in triggered:\n    print(f''\\n--- {r.rule_name} ---'')\n    if r.anomaly:\n        print(f''  라인: {r.anomaly.line_index}'')\n        print(f''  심각도: {r.anomaly.severity}'')\n        print(f''  메시지: {r.anomaly.message}'')\n        if r.anomaly.context and ''fix'' in r.anomaly.context:\n            print(f''  해결: {r.anomaly.context[\"\"fix\"\"]}'')\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport asyncio\nimport json\nfrom gcode_analyzer.analyzer import run_analysis\n\nasync def test():\n    result = await run_analysis(\n        file_path=''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'',\n        filament_type=''PLA'',\n        auto_approve=False,\n        analysis_mode=''full'',\n        language=''ko''\n    )\n    \n    print(''=== 분석 완료 ==='')\n    \n    # 이슈 확인\n    issues = result.get(''issues_found'', [])\n    print(f''\\n발견된 이슈: {len(issues)}개'')\n    for i, issue in enumerate(issues):\n        print(f''\\n--- 이슈 {i+1} ---'')\n        print(f''  유형: {issue.get(\"\"issue_type\"\", \"\"unknown\"\")}'')\n        print(f''  심각도: {issue.get(\"\"severity\"\", \"\"unknown\"\")}'')\n        print(f''  라인: {issue.get(\"\"line_index\"\", issue.get(\"\"line\"\", \"\"?\"\"))}'')\n        desc = issue.get(''description'', issue.get(''message'', ''''))\n        print(f''  설명: {desc[:100] if desc else \"\"없음\"\"}'')\n        fix = issue.get(''solution'', issue.get(''fix_proposal'', issue.get(''context'', {}).get(''fix'', '''')))\n        print(f''  해결: {fix[:80] if fix else \"\"없음\"\"}'')\n    \n    # 패치 확인\n    patch_plan = result.get(''patch_plan'')\n    if patch_plan:\n        patches = patch_plan.get(''patches'', [])\n        print(f''\\n제안된 패치: {len(patches)}개'')\n        for i, patch in enumerate(patches[:5]):\n            print(f''\\n--- 패치 {i+1} ---'')\n            print(f''  라인: {patch.get(\"\"line_index\"\", patch.get(\"\"line\"\", \"\"?\"\"))}'')\n            print(f''  액션: {patch.get(\"\"action\"\", \"\"?\"\")}'')\n    else:\n        print(''\\n패치 계획 없음'')\n\nasyncio.run(test())\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nimport asyncio\nimport json\nfrom gcode_analyzer.analyzer import run_analysis\n\nasync def test():\n    result = await run_analysis(\n        file_path=''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'',\n        filament_type=''PLA'',\n        auto_approve=False,\n        analysis_mode=''full'',\n        language=''ko''\n    )\n    \n    # 이슈 데이터 구조 확인\n    issues = result.get(''issues_found'', [])\n    print(f''발견된 이슈: {len(issues)}개'')\n    for i, issue in enumerate(issues):\n        print(f''\\n--- 이슈 {i+1} 전체 데이터 ---'')\n        print(json.dumps(issue, indent=2, ensure_ascii=False, default=str))\n\nasyncio.run(test())\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"\nfrom gcode_analyzer.parser import parse_gcode\nfrom gcode_analyzer.temp_tracker import extract_temp_events\nfrom gcode_analyzer.section_detector import detect_sections\nfrom gcode_analyzer.rule_engine import run_all_rules, get_llm_review_needed\nfrom gcode_analyzer.event_analyzer import analyze_all_temp_events\n\n# 파싱\nresult = parse_gcode(''C:/Users/USER/Downloads/1765894653684_gg_fixed_heateroff_at_end.gcode'')\nlines = result.lines\ntemp_events = extract_temp_events(lines)\nboundaries = detect_sections(lines)\n\n# 규칙 실행\nrule_results = run_all_rules(lines, temp_events, boundaries)\nllm_review_from_rules = get_llm_review_needed(rule_results)\n\nprint(''=== 규칙에서 LLM 리뷰 필요 ==='')\nfor r in llm_review_from_rules:\n    if r.anomaly:\n        print(f''  라인 {r.anomaly.line_index}: {r.rule_name} - {r.anomaly.severity}'')\n\n# Python 1차 분석\nanalysis_results = analyze_all_temp_events(temp_events, boundaries, lines)\nneeds_llm = [r for r in analysis_results if r.needs_llm_analysis]\n\nprint(f''\\n=== event_analyzer에서 LLM 필요 ({len(needs_llm)}개) ==='')\nfor r in needs_llm[:5]:\n    d = r.dict()\n    print(f''  라인 {d[\"\"event\"\"][\"\"line_index\"\"]}: {d[\"\"anomaly_type\"\"]} - {d[\"\"reason\"\"][:50]}'')\n\")",
      "Bash(\"/c/Users/USER/anaconda3/python.exe\" -c \"import langchain_openai; print(''OK'')\")",
      "Bash(/c/Users/USER/anaconda3/python.exe:*)",
      "Bash(.venv/Scripts/python.exe:*)",
      "Bash(del \"c:\\Users\\USER\\factor_AI_python\\gcode_analyzer\\llm\\patch_generator.py\")",
      "Bash(del \"c:\\Users\\USER\\factor_AI_python\\gcode_analyzer\\llm\\patch_generator_prompt.py\")",
      "Bash(curl:*)",
      "Bash(\"C:/Users/USER/anaconda3/python.exe\" test_analysis.py)",
      "Bash(python test_inline.py:*)",
      "Bash(dir \"c:\\\\Users\\\\USER\\\\factor_AI_python\")",
      "Bash(findstr:*)",
      "Bash(C:\\\\Users\\\\USER\\\\anaconda3\\\\python.exe:*)",
      "Bash(rm:*)",
      "Bash(python test_gemini3.py:*)",
      "Bash(python test_all_models.py:*)"
    ],
    "deny": [],
    "ask": []
  }
}
