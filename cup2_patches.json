[
  {
    "patch_id": "PATCH-001",
    "issue_id": "ISSUE-1",
    "line_number": 525,
    "action": "add_after",
    "can_auto_apply": true,
    "original_code": {
      "line": "525: M140 S65",
      "context_before": [
        "520: ",
        "521: ;===== start to heat heatbead&hotend====",
        "522: M1002 gcode_claim_action : 2",
        "523: M1002 set_filament_type:PLA",
        "524: M104 S140"
      ],
      "context_after": [
        "526: ",
        "527: ;=====start printer sound ===================",
        "528: M17",
        "529: M400 S1",
        "530: M1006 S1"
      ]
    },
    "patched_code": {
      "line": "525: M140 S65",
      "context_before": [
        "520: ",
        "521: ;===== start to heat heatbead&hotend====",
        "522: M1002 gcode_claim_action : 2",
        "523: M1002 set_filament_type:PLA",
        "524: M104 S140"
      ],
      "context_after": [
        "526: ",
        "527: ;=====start printer sound ===================",
        "528: M17",
        "529: M400 S1",
        "530: M1006 S1"
      ]
    },
    "explanation": "베드 온도 설정(M140 S65) 후 즉시 프린팅이 시작되어 접착 불량 우려가 있습니다. 베드 온도가 설정 온도(65도)에 도달할 때까지 대기하는 M190 명령을 추가하여 베드 예열 부족 문제를 해결합니다.",
    "risk_level": "high",
    "additional_lines": [
      "M190 S65"
    ]
  },
  {
    "patch_id": "PATCH-002",
    "issue_id": "ISSUE-2",
    "line_number": 589,
    "action": "no_action",
    "can_auto_apply": false,
    "original_code": {
      "line": "M109 S25 H140",
      "context_before": [
        "G0 X128 F30000",
        "G0 Y254 F3000",
        "G91",
        "G1 Z-5 F1200",
        ""
      ],
      "context_after": [
        "",
        "M17 E0.3",
        "M83",
        "G1 E10 F1200",
        "G1 E-0.5 F30"
      ]
    },
    "patched_code": {
      "line": "M109 S25 H140",
      "context_before": [
        "G0 X128 F30000",
        "G0 Y254 F3000",
        "G91",
        "G1 Z-5 F1200",
        ""
      ],
      "context_after": [
        "",
        "M17 E0.3",
        "M83",
        "G1 E10 F1200",
        "G1 E-0.5 F30"
      ]
    },
    "explanation": "해당 G-code 라인은 Bambu Studio/Orca 슬라이서에서 사용하는 H 파라미터를 포함하고 있습니다. H 파라미터는 실제 설정된 온도를 나타내므로, S 파라미터 값만 보고 판단하여 수정하는 것은 안전하지 않습니다. H140은 PLA 권장 온도 범위(200-220도)와는 다르지만, 벤더 확장 기능일 수 있으므로 임의로 수정하지 않고 'no_action'으로 처리합니다. 만약 실제 온도가 낮아 문제가 발생한다면, 슬라이서 설정에서 해당 벤더 확장 값을 직접 확인하고 조정해야 합니다.",
    "risk_level": "medium",
    "additional_lines": []
  },
  {
    "patch_id": "PATCH-003",
    "issue_id": "ISSUE-3",
    "line_number": 598,
    "action": "modify",
    "can_auto_apply": true,
    "original_code": {
      "line": "598: M104 S220",
      "context_before": [
        "593: G1 E10 F1200",
        "594: G1 E-0.5 F30",
        "595: M17 D",
        "596: ",
        "597: G28 Z P0 T140; home z with low precision,permit 300deg temperature"
      ],
      "context_after": [
        "",
        "600: M1002 judge_flag build_plate_detect_flag",
        "601: M622 S1",
        "602: G39.4",
        "603: G90"
      ]
    },
    "patched_code": {
      "line": "598: M109 S200",
      "context_before": [
        "593: G1 E10 F1200",
        "594: G1 E-0.5 F30",
        "595: M17 D",
        "596: ",
        "597: G28 Z P0 T140; home z with low precision,permit 300deg temperature"
      ],
      "context_after": [
        "",
        "600: M1002 judge_flag build_plate_detect_flag",
        "601: M622 S1",
        "602: G39.4",
        "603: G90"
      ]
    },
    "explanation": "이슈 ISSUE-3은 압출 명령 전에 노즐 온도가 충분히 도달하지 않는 문제를 지적합니다. 원본 G-code 라인 598의 `M104 S220`은 노즐 온도를 설정하지만 대기를 하지 않습니다. PLA 필라멘트의 권장 노즐 온도 범위(200-220도)와 이슈 설명에 따라, 압출 전에 노즐 온도가 설정된 온도에 도달하도록 대기하는 `M109 S200` 명령으로 수정하여 온도 도달을 보장합니다. `M109`는 온도 도달을 기다린 후 다음 명령을 실행합니다.",
    "risk_level": "medium",
    "additional_lines": []
  },
  {
    "patch_id": "PATCH-004",
    "issue_id": "ISSUE-4",
    "line_number": 628,
    "action": "modify",
    "can_auto_apply": true,
    "original_code": {
      "line": "628: M104 S250",
      "context_before": [
        "623: M620 S0A   ; switch material if AMS exist",
        "624: M1002 gcode_claim_action : 4",
        "625: M400",
        "626: M1002 set_filament_type:UNKNOWN",
        "627: M109 S220"
      ],
      "context_after": [
        "629: M400",
        "630: T0",
        "631: G1 X-48.2 F3000",
        "632: M400",
        "633:"
      ]
    },
    "patched_code": {
      "line": "628: M104 S220",
      "context_before": [
        "623: M620 S0A   ; switch material if AMS exist",
        "624: M1002 gcode_claim_action : 4",
        "625: M400",
        "626: M1002 set_filament_type:UNKNOWN",
        "627: M109 S220"
      ],
      "context_after": [
        "629: M400",
        "630: T0",
        "631: G1 X-48.2 F3000",
        "632: M400",
        "633:"
      ]
    },
    "explanation": "PLA 필라멘트의 권장 노즐 온도 범위를 초과하는 250도로 설정되어 있어, PLA에 적합한 220도로 수정합니다.",
    "risk_level": "low",
    "additional_lines": []
  },
  {
    "patch_id": "PATCH-005",
    "issue_id": "ISSUE-5",
    "line_number": 650,
    "action": "modify",
    "can_auto_apply": true,
    "original_code": {
      "line": "650: M104 S220",
      "context_before": [
        "645: G1 E50 F200 ; lower extrusion speed to avoid clog",
        "646: M400",
        "647: M106 P1 S178",
        "648: G92 E0",
        "649: G1 E5 F200"
      ],
      "context_after": [
        "651: G92 E0",
        "652: M73 P1 R136",
        "653: G1 E-0.5 F300",
        "654: ",
        "655: G1 X-28.5 F30000"
      ]
    },
    "patched_code": {
      "line": "650: M109 S220",
      "context_before": [
        "645: G1 E50 F200 ; lower extrusion speed to avoid clog",
        "646: M400",
        "647: M106 P1 S178",
        "648: G92 E0",
        "649: G1 E5 F200"
      ],
      "context_after": [
        "651: G92 E0",
        "652: M73 P1 R136",
        "653: G1 E-0.5 F300",
        "654: ",
        "655: G1 X-28.5 F30000"
      ]
    },
    "explanation": "압출 시작 전 노즐 온도가 충분히 도달하지 않는 이슈가 발견되었습니다. M104 S220은 설정된 온도로 바로 이동하는 G-code이지만, 실제 온도 도달을 기다리지 않습니다. M109 S220으로 변경하여 노즐 온도가 220도에 도달할 때까지 대기하도록 수정하여 압출 전 충분한 온도를 확보합니다.",
    "risk_level": "high",
    "additional_lines": []
  }
]